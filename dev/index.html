<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<link rel="icon" type="image/x-icon" href="images/logo.ico">
<title>BDeploy Developer Documentation</title>
<link rel="stylesheet" href="./plain.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="js/jquery-3.4.1.min.js"></script>
<script src="js/lightgallery-all.min.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("#content").lightGallery({
            mode: 'lg-fade',
            share: false,
            thumbnail: false,
            hideBarsDelay: 1000,
            selector: '.image'
        });
    });
</script>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>BDeploy Developer Documentation</h1>
<div class="details">
<span id="revnumber">version 4.2.2</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_bhive">BHive</a>
<ul class="sectlevel2">
<li><a href="#_bhive_tour">BHive Tour</a></li>
<li><a href="#_treesnapshot_co">TreeSnapshot &amp; Co.</a></li>
</ul>
</li>
<li><a href="#_pcu_process_control_unit">PCU (Process Control Unit)</a></li>
<li><a href="#_dcu_deployment_control_unit">DCU (Deployment Control Unit)</a>
<ul class="sectlevel2">
<li><a href="#_backends">Backends</a></li>
</ul>
</li>
<li><a href="#_common">Common</a>
<ul class="sectlevel2">
<li><a href="#_securityhelper">SecurityHelper</a></li>
<li><a href="#_configuration">Configuration</a></li>
<li><a href="#_activityreporter">ActivityReporter</a></li>
<li><a href="#_metrics">Metrics</a></li>
<li><a href="#_troubleshooting">Troubleshooting</a></li>
</ul>
</li>
<li><a href="#_minion_masternode_server">Minion (master/node) Server</a></li>
<li><a href="#_client_launcher">Client Launcher</a></li>
<li><a href="#_interfaces">Interfaces</a>
<ul class="sectlevel2">
<li><a href="#_model_class_naming">Model Class Naming</a></li>
<li><a href="#_variable_expansion">Variable Expansion</a></li>
</ul>
</li>
<li><a href="#_manifests">Manifests</a>
<ul class="sectlevel2">
<li><a href="#_metamanifests">MetaManifests</a></li>
</ul>
</li>
<li><a href="#_ui_front_and_backend">UI Front- and Backend</a>
<ul class="sectlevel2">
<li><a href="#_theming">Theming</a></li>
</ul>
</li>
<li><a href="#_development_setup">Development Setup</a>
<ul class="sectlevel2">
<li><a href="#_environment_setup">Environment Setup</a></li>
<li><a href="#_repository_and_gradle_build">Repository and Gradle Build</a></li>
<li><a href="#_eclipse_workspace">Eclipse Workspace</a></li>
<li><a href="#_running_bdeploys_web_ui_from_vscode">Running BDeploy&#8217;s Web UI from VSCode</a></li>
<li><a href="#_building_for_other_platforms">Building for other platforms</a></li>
</ul>
</li>
<li><a href="#_plugins">Plugins</a>
<ul class="sectlevel2">
<li><a href="#_plugin_distribution">Plugin Distribution</a></li>
<li><a href="#_how_to_create_a_plugin">How to create a plugin</a></li>
<li><a href="#_the_javascript_plugin_api">The JavaScript Plugin API</a></li>
</ul>
</li>
<li><a href="#_release_procedure">Release Procedure</a>
<ul class="sectlevel2">
<li><a href="#_preparation">Preparation</a></li>
<li><a href="#_branches_tags_github_release">Branches, Tags &amp; GitHub Release</a></li>
<li><a href="#_release_notes">Release notes</a></li>
<li><a href="#_mavencentral_release">MavenCentral release</a></li>
<li><a href="#_documentation_update">Documentation Update</a></li>
<li><a href="#_build_tool_integration_plugin_update">Build Tool Integration Plugin Update</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<img src="images/logo.svg" alt="Logo" width="200">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This documentation aims at developers that want to get more information about the underlying concepts and how to build and run BDeploy locally.</p>
</div>
<div class="paragraph">
<p>For people wanting to <em>use</em> BDeploy please refer to the end user documentation that is provided on our homepage <a href="https://bdeploy.io" class="bare">https://bdeploy.io</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bhive">BHive</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The BHive (short: hive) provides a mechanism to store and transfer files over the network. It decouples storage of file content and hierarchical filesystem layout descriptions (trees). The mechanism is similar to how GIT stores files. File content is stored and identified by using the content&#8217;s checksum.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/merkle.png"><img src="images/merkle.png" alt="Merkle Hash Tree" width="480"></a>
</div>
</div>
<div class="paragraph">
<p>Here some properties of BHive:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The BHive uses a <a href="https://en.wikipedia.org/wiki/Merkle_tree">Merkle Hash Tree</a> to store data much like GIT does (similar technology is also used for implementing blockchains).</p>
</li>
<li>
<p>Consistency of objects can be verified by calculating the checksum of the content and comparing it with the name of the file storing that content.</p>
</li>
<li>
<p>BHive knows four different types of objects: <code>BLOB</code> (any file content), <code>TREE</code> (a list of <code>BLOB</code>, <code>TREE</code>, <code>MREF</code> entries), <code>MREF</code> (a reference to a to-be-nested <code>MANIFEST</code>), <code>MANIFEST</code> (associates some meta-data with a root <code>TREE</code>).</p>
</li>
<li>
<p>All known object types (except <code>MANIFEST</code>) are stored using the exact same mechanism (<code>ObjectDatabase</code>). This means verifying the consistency of whole trees is as simple as verifying consistency of individual files.</p>
</li>
<li>
<p><code>MANIFEST</code> are stored in a separate <code>ManifestDatabase</code>, this is to allow named storage and reference to <code>MANIFEST</code>, since they are the top-level entry point into the BHive. Most high level operations will require <code>Manifest.Key</code> objects as parameters.</p>
</li>
<li>
<p>BHive has a command line tooling to allow direct manipulation of local and remote hives: <code>io.bdeploy.bhive.cli.BHiveCli</code></p>
</li>
<li>
<p>BHive has a standalone server (using the above cli) which allows serving BHives without BDeploy.</p>
</li>
<li>
<p>A <code>io.bdeploy.bhive.BHive</code> does not expose API, use <code>Hive.Operation</code> defined in the <code>io.bdeploy.bhive.op</code> package to programmatically interact with a hive.</p>
</li>
<li>
<p><code>Hive.Operation</code> can be implemented externally, to provide new functionality operating on a BHive from the outside.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_bhive_tour">BHive Tour</h3>
<div class="paragraph">
<p>This chapter, along with the launch configuration available in the bhive project, will give a short tour around most
of the functionality that bhive provides.</p>
</div>
<div class="paragraph">
<p>All launch configurations used will use a BHive target in a runtime workspace in the containing workspace (<code>${workspace_loc}/runtime-hive</code>) in case you want to have a look at it.</p>
</div>
<div class="sect3">
<h4 id="_import">Import</h4>
<div class="paragraph">
<p><em>Import</em> is the act of digesting a folder recursively into a BHive storage. There are two important parameters: the source folder and the destination BHive. Since BHive creates an empty hive automatically in the destination, the target BHive directory is allowed to be non-existant. The source folder is not required to follow <em>any</em> rules at this low-level stage. BHive will simply digest any file found recursively. While doing so, it separates each files content from it&#8217;s name. They are stored in separate locations (content as 'blob', name is stored in a 'tree' as 'pointer' to the 'blob' for this file&#8217;s content).</p>
</div>
<div class="paragraph">
<p>Use the <strong>Hive-Import</strong> launch configuration to import a directory into the BHive. The launch will prompt for two things:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The folder to import. You can choose any folder to import. The target hive is created automatically if it does not exists.</p>
</li>
<li>
<p>The name (manifest key) of the imported tree. This name can be used to reference the imported tree later on. Note that a name:tag combination must be unique. Import will fail if the manifest key is already used.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that all BHive objects are immutable, meaning that there are never changes to any existing file. This is analogous to GIT. Manifests are <strong>not</strong> BHive objects but more special (they just <strong>reference</strong> a root tree BHive object). They are mutable in that labels can be added and removed from the manifest.</p>
</div>
</div>
<div class="sect3">
<h4 id="_list">List</h4>
<div class="paragraph">
<p>You can list the content of the BHive after importing by running the <strong>Hive-Manifest-List</strong> launch configuration. It will simply list all available manifests in the BHive.</p>
</div>
</div>
<div class="sect3">
<h4 id="_export">Export</h4>
<div class="paragraph">
<p>The inverse operation of an <em>Import</em> is (surprise) an <em>Export</em>, which means restoring a file/folder tree exactly as it was imported. The export will scan a manifest for 'tree' objects and write all 'blob' objects to the locations described there.</p>
</div>
<div class="paragraph">
<p>Run the <strong>Hive-Export</strong> launch configuration and specify a target folder (which may not yet exist). Next specify a manifest to export, use the key you specified during <a href="#_import">Import</a>.</p>
</div>
<div class="paragraph">
<p>Check the directory, you will notice that all files have been written back on disc, and the folder content is equal to the one imported.</p>
</div>
</div>
<div class="sect3">
<h4 id="_remote_serve">Remote Serve</h4>
<div class="paragraph">
<p>BHive provides a small embedded server which allows serving any number of local hives through HTTPS.</p>
</div>
<div class="paragraph">
<p>Run the <strong>Hive-Remote-Serve</strong> launch configuration to run the server, serving the BHive created with the <strong>Hive-Import</strong> application.</p>
</div>
<div class="paragraph">
<p>Note: the sample launch configurations use the test-only pre-built certificates from the <em>jersey</em> project.</p>
</div>
</div>
<div class="sect3">
<h4 id="_remote_list">Remote List</h4>
<div class="paragraph">
<p>The same list operation as before (<strong>Hive-Manifest-List</strong>) can be performed on the remote server as well, as long as <strong>Hive-Remote-Serve</strong> is still running.</p>
</div>
<div class="paragraph">
<p>Run <strong>Hive-Remote-List</strong> to try it - this will go through the HTTPS stack and perform the manifest listing remotely.</p>
</div>
</div>
<div class="sect3">
<h4 id="_remote_fetch_push">Remote Fetch &amp; Push</h4>
<div class="paragraph">
<p>The two tools <em>fetch</em> and <em>push</em> allow to fetch and push manifests along with all required objects from and to a remote hive.</p>
</div>
<div class="paragraph">
<p>Both operations are practically identical, just reversed. To demonstrate fetch, run <strong>Hive-Remote-Fetch</strong> and specify the manifest key you imported before. This will create a new (empty) hive (on first run) next to the one created by import (<code>${workspace_loc}/runtime-hive-fetched</code>) and fetch this manifest into that hive. Make sure that <strong>Hive-Remote-Serve</strong> is still running for this to work.</p>
</div>
<div class="paragraph">
<p>If you are interested, you can try to <em>import</em> another folder which shares some parts with the first one you imported. Due to the separation of content and location, each common file will be stored only once, regardless of it&#8217;s location (name) in the tree. This will also enable fetch/push to transfer only missing objects.</p>
</div>
</div>
<div class="sect3">
<h4 id="_fsck">FSCK</h4>
<div class="paragraph">
<p>The <em>FSCK</em> (short for 'filesystem check') will check consistency of all objects and manifests in e BHive. Run <strong>Hive-FSCK</strong> to execute a <em>FSCK</em> on the sample BHive.</p>
</div>
</div>
<div class="sect3">
<h4 id="_delete">Delete</h4>
<div class="paragraph">
<p>Manifests can be deleted from a BHive as well. Run <strong>Hive-Manifest-Delete</strong> to delete a manifest. Be sure to give the same manifest key as with <strong>Hive-Import</strong>.</p>
</div>
<div class="paragraph">
<p>Note that this operation only deletes the manifest, but <strong>not</strong> automatically all now-unreferenced objects from the object database. This is done by <a href="#_prune">Prune</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_prune">Prune</h4>
<div class="paragraph">
<p><em>Pruning</em> is a cleanup operation which removes unreferenced objects from the storage. It is comparable to a <em>git gc</em>.</p>
</div>
<div class="paragraph">
<p>Run <strong>Hive-Prune</strong> after running <strong>Hive-Manifest-Delete</strong> to see the effects of pruning remaining objects. If you had only one manifest and deleted that, the result should be that the <em>objects</em> directory in the hive contains no files anymore (only empty directories).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_treesnapshot_co">TreeSnapshot &amp; Co.</h3>
<div class="paragraph">
<p>The <code>ScanOperation</code> allows to fetch a <code>TreeSnapshot</code> of a <code>MANIFEST</code> root tree. This allows to recursively retrieve all available/relevant information about a <code>MANIFEST</code>. This includes a listing of <code>TREE</code>, <code>BLOB</code>, <code>MREF</code>, missing/damaged objects, etc.</p>
</div>
<div class="paragraph">
<p>The <code>TreeDiff</code> allows to compare two <code>TreeSnapshot</code> objects. It will produce a <code>TreeElementDiff</code> for each element which is different in the two snapshots. This diff is based on the type and checksum of the according path entries in the snapshots. There is no actual content diff, but it is 'ease' to build one based on the available information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pcu_process_control_unit">PCU (Process Control Unit)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The PCU consumes a pre-rendered (meaning all parameter value variables are resolved, all paths are absolute, etc.) configuration to control and run locally.</p>
</div>
<div class="paragraph">
<p>The PCU does not make any assumptions about locations, etc. It relies completely on external sources to prepare a <code>ProcessGroupConfiguration</code> and the according <code>ProcessConfiguration</code> per configured application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dcu_deployment_control_unit">DCU (Deployment Control Unit)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The DCU&#8217;s <code>InstanceNodeController</code> is responsible for consuming an <code>InstanceNodeManifest</code>. An <code>InstanceNodeManifest</code> is an artificial BHive manifest created by a configuration application, typically the web UI.</p>
</div>
<div class="paragraph">
<p>The DCU assumes that any referenced BHive <code>MANIFEST</code> is locally available, i.e. has been pushed to the BHive associated with the DCU before passing a reference to it to the DCU.</p>
</div>
<div class="paragraph">
<p>Note that the DCU does not know about multiple nodes in a system. It assumes that everything is local, and so do all data structures in the DCU. The minion controlling the local DCU may have additional higher level structures to allow multiple DCUs distributed among nodes deploying for a single <code>InstanceManifest</code>.</p>
</div>
<div class="sect2">
<h3 id="_backends">Backends</h3>
<div class="paragraph">
<p>Right now, there is only a single DCU, which has the nodes physical disc as manifestation target.</p>
</div>
<div class="paragraph">
<p>The architecture is designed in a way to be able to later on have plug-able DCUs, which assume responsibility for a certain node type. This allows to implement specific DCUs later and mix and match them on a node level. For instance a special "Kubernetes" node could allow to drop applications into a cluster, having the cluster side-by-side with classic local application installation (but sharing configuration data, &#8230;&#8203;).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_common">Common</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This bundle contains things shared by all components (BHive, DCU, PCU, Minion, &#8230;&#8203;).</p>
</div>
<div class="sect2">
<h3 id="_securityhelper">SecurityHelper</h3>
<div class="paragraph">
<p>The <code>io.bdeploy.common.security</code> package contains the <code>SecurityHelper</code> which can be used to generate and verify keystores and access tokens for remote APIs (over HTTP).</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration">Configuration</h3>
<div class="paragraph">
<p>The <code>io.bdeploy.common.cfg</code> package contains the <code>Configuration</code> class which can be used to create command line tools and map their parameters to annotation proxies.</p>
</div>
</div>
<div class="sect2">
<h3 id="_activityreporter">ActivityReporter</h3>
<div class="paragraph">
<p>The <code>ActivityReporter</code> implementations (<code>Stream</code> and <code>Null</code>) can be used to track activities/operations.</p>
</div>
</div>
<div class="sect2">
<h3 id="_metrics">Metrics</h3>
<div class="paragraph">
<p>The <code>io.bdeploy.common.metrics</code> package contains an entry point to allow measurement of various metrics.</p>
</div>
</div>
<div class="sect2">
<h3 id="_troubleshooting">Troubleshooting</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The JUnit5 <code>@RegisterExtension</code> annotation allows to register <strong>instances</strong> of extensions (as opposed to <code>@ExtendWith</code>, which registers a class and manages it&#8217;s lifecycle as apropriate). This means that the <strong>instance</strong> does not changed. This on the other hand means that the instance <strong>fields</strong> of this extension will keep their state throughout test methods. This is not dramatic, just something you need to be aware of. This is the reason why <code>TestMinion</code> calls <code>resetRegistrations()</code> in it&#8217;s <code>beforeEach</code> method. Not doing so led to duplicate registrations of singleton services, where the server picked up the services for another test later on&#8230;&#8203;</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_minion_masternode_server">Minion (master/node) Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The minion is the main BDeploy deliverable. It contains all the command tools as well as the server for remote services and the configuration web UI.</p>
</div>
<div class="paragraph">
<p>Use <code>bdeploy init &#8230;&#8203;</code> to initalize a minion root, then use <code>bdeploy start &#8230;&#8203;</code> to launch a master (including web UI) or a headless node (controlled by a master) from that root, depending on the mode given during <code>init</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_client_launcher">Client Launcher</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The client launcher picks up <strong>.bdeploy</strong> files passed on the command line and handles application download/synchronization with the origin server, as well as installation in a cache directory and launching of the installed application(s).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_interfaces">Interfaces</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_model_class_naming">Model Class Naming</h3>
<div class="paragraph">
<p>The classes in this project follow a strict naming scheme.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class Name Suffix</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*Descriptor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Things which are provided by the 'outside' world to describe artifacts processed by us.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*Configuration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds data generated by us, based on *Descriptors, user input, or even thin air.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*Manifest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wraps and manages storage of *Configurations in the underlying BHives. Also handles enumeration/scanning for according objects in the BHive(s).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*Dto</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(not actually in the interfaces project, but ui specific). Holds/groups data which is required in this form for user display/interaction in the UI.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*Resource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interfaces for remote (JAX-RS) resources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*Provider</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Providers for variable expansion in configurations on the target system.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_variable_expansion">Variable Expansion</h3>
<div class="paragraph">
<p>This project contains the logic for resolving variables when deploying to a minion. The following schemes are supported.</p>
</div>
<div class="paragraph">
<p>Expansion of variables happens for launcher paths and parameter values. Additionally, all configuration files are post-processed on the target to perform the exact same expansion.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Provider</th>
<th class="tableblock halign-left valign-top">Variable Pattern</th>
<th class="tableblock halign-left valign-top">Supported Values</th>
<th class="tableblock halign-left valign-top">Example</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ApplicationParameterProvider</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{{V:[APP:]PARAM}}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>APP</code>: <em>(optional)</em> The name of the application to reference. If not given, the parameter is referenced within the same application as the referencing parameter</p>
</li>
<li>
<p><code>PARAM</code>: The name of the parameter</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{{V:MyServer:my.param.uid}}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expand the value of another parameter inline into the value of this parameter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DeploymentPathProvider</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{{P:PATH_ID}}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>CONFIG</code>: directory where all configuration files will be placed by deployment</p>
</li>
<li>
<p><code>BIN</code>: directory where all binaries are placed by deployment</p>
</li>
<li>
<p><code>RUNTIME</code>: directory with runtime data (e.d. stdout/stderr capture files)</p>
</li>
<li>
<p><code>DATA</code>: persistent data directory - the only directory shared by multiple deployments of the same instance.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{{P:CONFIG}}/myFile.json</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expand one of the special directories (see <code>SpecialDirectory</code>) know by the deployment process.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InstanceVariableResolver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{{I:VAR}}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>SYSTEM_PURPOSE</code>: the purpose of the instance, see <code>InstancePurpose</code></p>
</li>
<li>
<p><code>UUID</code>: UUID of the instance</p>
</li>
<li>
<p><code>NAME</code>: name of the instance</p>
</li>
<li>
<p><code>PRODUCT_ID</code>: name of the <code>MANIFEST</code> key&#8217;s name of the configured product</p>
</li>
<li>
<p><code>PRODUCT_TAG</code>: the tag (i.e. 'version') of the configured product</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{{I:SYSTEM_PURPOSE}}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expand values related to the instance containing the parameter&#8217;s process</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ManifestRefPathProvider</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{{M:MANIFEST_NAME[:TAG]}}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>MANIFEST_NAME</code>: the name of the manifest to reference. The variable will expand to the installation path of that other manifest.</p>
</li>
<li>
<p>TAG: <em>(optional)</em> if given expand to the exact manifest version.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{{M:openjdk/jre8}}/bin/java</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expand the absolute installation path to another manifest&#8217;s path on the target system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OsConditionalProvider</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{{OSNAME:VALUE}}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>OSNAME</code>: either <code>OperatingSystem</code> value (<code>WINDOWS</code>, <code>LINUX</code>, <code>AIX</code>).</p>
</li>
<li>
<p><code>VALUE</code>: the target value to expand if the target OS matches the <code>OSNAME</code> value.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&#8230;&#8203;/bin/java{{WINDOWS:.exe}}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Insert the given <code>VALUE</code> if and only if the given <code>OSNAME</code> (see <code>OperatingSystem</code>) matches.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MinionConfigVariableResolver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{{H:HOSTNAME}}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>HOSTNAME</code>: expands to the hostname of the target minion where the application is deployed.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{{H:HOSTNAME}}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expands to target minion properties - currently only <code>HOSTNAME</code> is supported.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_manifests">Manifests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Almost all of <strong>BDeploy</strong>'s storage is encapsulated in <strong>Manifests</strong> in a <strong>BHive</strong>. This holds true not only for actual application/product data, but for any configuration data as well. These have a few advantages over traditional storage:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Contents is immutable</p>
</li>
<li>
<p>Contents is validatable (through checksums)</p>
</li>
<li>
<p>Contents is automatically versioned</p>
</li>
<li>
<p>Contents history is available</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are a bunch of <strong>Manifests</strong> for several purposes.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/ManifestOverview.png"><img src="images/ManifestOverview.png" alt="Special Manifest Types" width="480"></a>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Manifest Name</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InstanceGroupManifest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores information (name, description, logo) related to an <strong>Instance Group</strong>. There is exactly one <code>InstanceGroupManifest</code> per <strong>Instance Group</strong> <strong>BHive</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SoftwareRepositoryManifest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores information (name, description) related to a <strong>Software Repository</strong>. There is exactly one <code>SoftwareRepositoryManifest</code> per <strong>Software Repository</strong> <strong>BHive</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InstanceManifest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>InstanceManifest</code> holds information about an instance and keeps track of the all <code>InstanceNodeManifest</code> for the <strong>Instance</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InstanceNodeManifest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keeps track of the <strong>Applications</strong> and their configuration per configured <strong>Node</strong> in the <strong>Instance</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ProductManifest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds information about a product and keeps track of all the <code>ApplicationManifest</code> for the <strong>Product</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ApplicationManifest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds information about a single application, includes the <code>app-info.yaml</code> for the application which holds information about all supported parameters, etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MinionManifest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds information about available nodes on a <strong>master</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UserDatabase</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manages special per-user <strong>Manifests</strong> which hold information about each user.</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_metamanifests">MetaManifests</h3>
<div class="paragraph">
<p>In addition to traditional <strong>Manifest</strong> there are <strong>MetaManifest</strong>. These allow to <em>attach</em> certain information to other <strong>Manifests</strong>. This allows to update the attached <strong>MetaManifest</strong> independently of the <em>immutable</em> <strong>Manifest</strong>, whilst keeping all benefits of a <strong>Manifest</strong> for the <strong>MetaManifest</strong> as well (versioning, history, &#8230;&#8203;).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">MetaManifest Name</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InstanceState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keeps track of <strong>Instance</strong> state related information (installed <strong>Instance</strong> versions, activated <strong>Instance</strong> version, etc.).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InstanceManifestHistory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keeps track of the history of an <strong>Instance</strong> version, storing timestamps at which certain actions happened (creation, installation, activation, etc.).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ManagedMasters</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keeps track of attached managed masters on a central master.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ControllingMaster</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keeps track of the responsible controlling master for a single <strong>Instance</strong>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ui_front_and_backend">UI Front- and Backend</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Contains the angular based Web frontend as well as the matching backend which is used to communicate with the server. The <strong>BDeploy</strong> CLI uses the same backend.</p>
</div>
<div class="sect2">
<h3 id="_theming">Theming</h3>
<div class="paragraph">
<p>The <code>app-theme.scss</code> currently supports dark and light themes. Components can contribute their own themes using SCSS mixins, but typically don&#8217;t no longer do so since 4.0.0. <code>app-common.scss</code> provides a set of common styles for all components. Theme colors are available through CSS variables.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_development_setup">Development Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>BDeploy uses the <strong>Eclipse IDE</strong> for backend- and <strong>VSCode</strong> for frontend-development. You will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Get the latest <a href="https://adoptium.net/">OpenJDK 17</a>.</p>
</li>
<li>
<p>Get the latest <a href="https://www.eclipse.org/downloads/">Eclipse IDE</a> including Java 17 support.</p>
<div class="ulist">
<ul>
<li>
<p>You need to have the <a href="https://marketplace.eclipse.org/content/launch-configuration-dsl">Launch Configuration DSL (LcDsl)</a> extension installed.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://code.visualstudio.com/download">VSCode</a></p>
<div class="ulist">
<ul>
<li>
<p>You need to have the <a href="https://marketplace.visualstudio.com/items?itemName=johnpapa.angular-essentials">Angular Essentials</a> extension installed.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://www.npmjs.com/get-npm">NPM</a></p>
<div class="ulist">
<ul>
<li>
<p>Some people prefer to use <a href="https://github.com/nvm-sh/nvm">NVM</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://git-scm.com/downloads">GIT</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_environment_setup">Environment Setup</h3>
<div class="ulist">
<ul>
<li>
<p>You will want to set the <code>JAVA_HOME</code> environment variable to point to the path where you extracted the <strong>OpenJDK 17</strong> package to assure that the build picks up the correct Java.</p>
</li>
<li>
<p>Make sure that the <code>npm</code> command works from the command line where you will run <code>gradle</code> builds (<code>cmd.exe</code> on Windows, <code>bash</code> on Linux).</p>
</li>
<li>
<p>Install the <strong>Angular CLI</strong> globally for easier working by running <code>npm install -g @angular/cli</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You need root permissions on Linux if you installed NodeJS (and NPM) through your distribution to be able to globally install the <strong>Angular CLI</strong>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_repository_and_gradle_build">Repository and Gradle Build</h3>
<div class="paragraph">
<p>This documentation will assume the path <code>/work/bdeploy</code> to be available, if not substitute it with any other path that works for you.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Clone the repository: <code>cd /work/bdeploy &amp;&amp; git clone <a href="https://github.com/bdeployteam/bdeploy.git" class="bare">https://github.com/bdeployteam/bdeploy.git</a></code></p>
</li>
<li>
<p>Change to the repository directory: <code>cd bdeploy</code></p>
</li>
<li>
<p>Start the <code>gradle</code> build</p>
<div class="ulist">
<ul>
<li>
<p><code>./gradlew build</code> on Linux (<code>bash</code>)</p>
</li>
<li>
<p><code>.\gradlew.bat build</code> on Windows (<code>cmd.exe</code>)</p>
</li>
<li>
<p>The build should conclude with a <code>BUILD SUCCESSFUL</code> message</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>gradle</code> build will build test and package BDeploy. You can find build artifacts after the build here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>./launcher/build/distributions</code> - Distributable packages of the launcher application which is used to start client applications.</p>
</li>
<li>
<p><code>./minion/build/distributions</code> - Distributable packages of the main BDeploy binaries. They contains the <strong>start</strong> (which runs <strong>BDeploy</strong> <strong>master</strong> and <strong>node</strong> servers) command as well as all CLI commands available to BDeploy Administrators. The distribution also contains all supported launcher packages as nested ZIP files.</p>
</li>
<li>
<p><code>./interfaces/build/libs/bdeploy-api-*-all.jar</code> - The distributable API bundle including all external dependencies. This can be used to create additional integrations for BDeploy.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, documentation deliverables can be found in the <code>./doc/build/docs/dev</code> and <code>./doc/build/docs/user</code> directories (developer and end-user documentation respectively).</p>
</div>
</div>
<div class="sect2">
<h3 id="_eclipse_workspace">Eclipse Workspace</h3>
<div class="paragraph">
<p>To be able to build, start and debug BDeploy backend applications from the Eclipse IDE, you need to perform some extra setup steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On the command line (see <a href="#_repository_and_gradle_build">Repository and Gradle Build</a>) generate the <strong>Eclipse IDE</strong> project files by running <code>./gradlew eclipse</code> (<code>gradlew eclipse</code> on windows).</p>
</li>
<li>
<p>Start the <strong>Eclipse IDE</strong> - choose a workspace, e.g. <code>/work/bdeploy/workspace</code>.</p>
</li>
<li>
<p>Open the <strong>Git Repositories</strong> view.</p>
</li>
<li>
<p>Click <strong>Add existing local repository</strong>, browse to the repository location (e.g. <code>/work/bdeploy/bdeploy</code>) and add it.</p>
</li>
<li>
<p>Right click the repository in the <strong>Git Repositories</strong> view and select <strong>Import Projects&#8230;&#8203;</strong>.</p>
<div class="ulist">
<ul>
<li>
<p>Select all projects with type <strong>Eclipse project</strong></p>
</li>
<li>
<p><strong>Don&#8217;t</strong> select the projects in the <em>eclipse-tea</em> folder.</p>
</li>
<li>
<p><strong>Don&#8217;t</strong> select projects of type <strong>Maven</strong>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This results in a complete BDeploy workspace setup which compiles automatically.</p>
</div>
<div class="sect3">
<h4 id="_running_bdeploy_from_eclipse">Running BDeploy from Eclipse</h4>
<div class="paragraph">
<p>BDeploy uses <strong>LcDsl</strong> launch configurations to run binaries. You can find launch configurations in the <strong>Launch Configurations</strong> view.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Find and run (hint: right click) the <code>Master-Init</code> launch configuration.</p>
<div class="ulist">
<ul>
<li>
<p>This will initialize a BDeploy <strong>master root</strong> inside the chosen workspace directory, e.g. <code>/work/bdeploy/workspace/runtime/master</code>.</p>
</li>
<li>
<p>A default user will be created: username = admin, password = admin.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Finally find and run the <code>Master</code> launch configuration to spin up a BDeploy <strong>master</strong>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The BDeploy master will host the Web UI also when started from the <strong>Eclipse IDE</strong>, but it will not work due to slightly different setup. You must use <strong>VSCode</strong> to host a matching Web UI for the backend run from <strong>Eclipse</strong>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_bdeploys_web_ui_from_vscode">Running BDeploy&#8217;s Web UI from VSCode</h3>
<div class="paragraph">
<p>To spin up a matching frontend for the master started in <a href="#_running_bdeploy_from_eclipse">Running BDeploy from Eclipse</a> you need to start the <strong>Angular</strong> application from within <strong>VSCode</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On the command line, navigate the the <code>./ui/webapp</code> directory in the repository (e.g. <code>/work/bdeploy/bdeploy/ui/webapp</code>) and run <strong>VSCode</strong> in the current directory using <code>code .</code></p>
</li>
<li>
<p>Open a terminal in <strong>VSCode</strong> and run <code>ng serve</code> to start the <strong>Angular</strong> development server. This will take a while to compile the Web UI.</p>
<div class="ulist">
<ul>
<li>
<p>The terminal can be opened using <span class="menuseq"><b class="menu">Terminal</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">New Terminal</b></span>.</p>
</li>
<li>
<p>The application will be started at <a href="http://localhost:4200" class="bare">http://localhost:4200</a> by default.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>BDeploy&#8217;s backend is HTTPS <strong>only</strong>. It uses a self-signed certificate by default. This will require to accept the certificate in the browser before <strong>any</strong> communication (especially from within the Web UI) can happen.</p>
</div>
<div class="paragraph">
<p>This makes it necessary to open a second tab in the browser and navigate to <a href="https://localhost:7701" class="bare">https://localhost:7701</a> to accept the security exception before the Web UI can communicate with the backend properly. Note that this URL will also load the Web UI once the security exception is in place, but will fail to start (see note above).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_building_for_other_platforms">Building for other platforms</h3>
<div class="paragraph">
<p>You can build distribution packages for other platforms by installing their respective JDKs. You need to specify those JDKs as properties during the build. To simplify the process, you can create these entries in <code>~/.gradle/gradle.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="properties">systemProp.win64jdk=/path/to/jdks/windows/jdk-17.0.1+12
systemProp.linux64jdk=/path/to/jdks/linux/jdk-17.0.1+12
#systemProp.mac64jdk=/path/to/jdks/mac/jdk-17.0.1+12/Contents/Home</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Of course you need to download those JDKs and adapt the paths to your environment.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_plugins">Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>BDeploy</strong> has plugin support, for now mainly to contribute custom parameter editors, for example to contribute an encryption algorithm to a password input field, etc.</p>
</div>
<div class="paragraph">
<p>From a low level viewpoint, plugins (as of now) may:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Contribute JAX-RS endpoints to the server side. These endpoints are provided in a dedicated JAX-RS application on the server, so basically all kinds of Providers, Features, Filters and Resources can be registered on the plugins behalf.</p>
</li>
<li>
<p>Contribute static assets. Those are served from a dedicated location per-plugin, and can host all kinds of static resources, including the required ES6 JavaScript modules used to provide custom editor UI.</p>
</li>
<li>
<p>Define custom editors and provide the matching ES6 module through the static resources mentioned above.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/plugins.svg"><img src="images/plugins.svg" alt="Plugins" width="480"></a>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The server will first load any global plugins that are installed. When loading a plugin, it is internally registered and a dedicated namespace is assigned where resources are served. The server will register the plugins JAX-RS endpoints and all static assets provided by the plugin under this context path. They are then directly accessible from the outside.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The Web UI will query for available custom editors once a parameter specifies it requires one (see <code>app-info.yaml</code> &#8594; <code>customEditor</code> in the end user documentation).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The Web UI&#8217;s plugin service will query the backend for plugins which can provide the requested editor(s). This will also demand-load plugins which are provided by the product backing the instance currently being edited. This works the same as for global plugins above.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Assuming the backend returned a plugin providing a suitable custom editor, the custom editor metadata includes the path to the JavaScript (ES6) module to load. The module is loaded into the Web application.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Then it is instantiated and passed an API object which can be used to transparently access the plugins exposed resources (JAX-RS API, static assets).</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The custom editor is bound to the Web UI on demand and can now perform edit operations on parametes, using its backend resources as required.</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_plugin_distribution">Plugin Distribution</h3>
<div class="paragraph">
<p>Plugins are distributed and loaded in two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A global plugin is a JAR file which is added to the server either through the command line or its UI. Global plugins provide functionality to be used by everything on the server globally on demand.</p>
</li>
<li>
<p>A product-bound (local) plugin is delivered through the product by configuring it in the <code>product-info.yaml</code>. See the user documentation for details.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_create_a_plugin">How to create a plugin</h3>
<div class="paragraph">
<p>A template to begin from is provided <a href="https://github.com/bdeployteam/bdeploy/tree/master/plugins">in the GitHub repository</a>. It contains all the bits required:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A plugin project must compile against the BDelpoy API JAR. This can be found either <a href="https://github.com/bdeployteam/bdeploy/packages/234722">in the GitHub packages Maven repository</a>, or on the <a href="https://github.com/bdeployteam/bdeploy/releases">releases page as plain JAR</a>.</p>
</li>
<li>
<p>A plugin must extend <code>io.bdeploy.api.plugin.v1.Plugin</code> class. It may override methods to provide its resources to <strong>BDeploy</strong>.</p>
</li>
<li>
<p>A plugin must specify some important MANIFEST.MF headers which help the <strong>BDeploy</strong> plugin system with identifying plugins:</p>
<div class="ulist">
<ul>
<li>
<p><code>BDeploy-Plugin</code>: This header should contain the fully qualified class name of the class extending the <code>io.bdeploy.api.plugin.v1.Plugin</code> class.</p>
</li>
<li>
<p><code>BDeploy-PluginName</code>: A human readable name for the plugin helping administrators identifying the plugin.</p>
</li>
<li>
<p><code>BDeploy-PluginVersion</code>: A version string, helping administrators identifying the plugins version.</p>
</li>
</ul>
</div>
</li>
<li>
<p>A plugin can contain JAX-RS resource for the backend</p>
</li>
<li>
<p>A plugin can contain ES6 JavaScript modules which provide custom editor UI for the user. In theory, you can use whatever you like, as long as it has a single JavaScript entrypoint file which can be loaded from the UI (e.g. Stencil WebComponents have been tested - you still need to provide the single entrypoint class though).</p>
<div class="ulist">
<ul>
<li>
<p>The ES6 module must contain a default exported class, so <strong>BDeploy</strong> can instantiate the plugin withough knowing its class names.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_the_javascript_plugin_api">The JavaScript Plugin API</h3>
<div class="paragraph">
<p>The <strong>Java</strong> API is pretty straight forward, and can be seen immediately when looking at the <code>io.bdeploy.api.plugin.v1.Plugin</code> class. It is a little bit different for the JavaScript API, as there are no interfaces you can look at. Internally, <strong>BDeploy</strong> uses TypeScript and thus it <em>has</em> an interface definition.</p>
</div>
<div class="sect3">
<h4 id="_the_custom_editor_api">The Custom Editor API</h4>
<div class="paragraph">
<p>The interface for a custom editor looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="typescript">export interface EditorPlugin {
  new(api: Api); <i class="conum" data-value="1"></i><b>(1)</b>
  bind(onRead: () =&gt; string, onUpdate: (value: string) =&gt; void, onValidStateChange: (valid: boolean) =&gt; void): HTMLElement; <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A custom editor definiton in the plugins main class points to an ES6 module, whos default class must implement this interface.</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The constructor accepts an <a href="#_the_api_object">API object</a>, which can be used to interface with the JAX-RS resources of the plugin.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The bind method receives callbacks for communication with the configuration web UI, and returns an HTMLElement which has to be created by the plugin.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_the_api_object">The API Object</h4>
<div class="paragraph">
<p>The API Object is passed to the plugins constructor. It allows communication with the plugins backend, without the need for the plugin to know where exactly this API is hosted on the server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="typescript">export interface Api {
  get(path: string, params?: {[key: string]: string}): Promise&lt;any&gt<i class="conum" data-value="1"></i><b>(1)</b>
  put(path: string, body: any, params?: {[key: string]: string}): Promise&lt;any&gt;;
  post(path: string, body: any, params?: {[key: string]: string}): Promise&lt;any&gt;;
  delete(path: string, params?: {[key: string]: string}): Promise&lt;any&gt;;
  getResourceUrl(): string; <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>get</code>, <code>put</code>, <code>post</code> and <code>delete</code> methods can be used to issue according requests to the plugins JAX-RS resources.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The resource URL can be used to load static resources. The URL will be the base URL where static and JAX-RS resources are registered.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_release_procedure">Release Procedure</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_preparation">Preparation</h3>
<div class="paragraph">
<p>Make sure to run a manual test and check at least this before releasing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Setup a fresh server.</p>
</li>
<li>
<p>Create an instance with a client application.</p>
</li>
<li>
<p>Download the installer for the client and check if it is working as intended.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The rest is covered pretty well by automated tests already.</p>
</div>
</div>
<div class="sect2">
<h3 id="_branches_tags_github_release">Branches, Tags &amp; GitHub Release</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The steps outlined in this chapter are usually encapsuled in a single automated release job (Jenkins, &#8230;&#8203;).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Prerequisites:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Know the version you want to release (i.e. <code>RELEASE_VERSION</code>)</p>
</li>
<li>
<p>Know the "next" version, which will be the one set as active version <strong>after</strong> the release (i.e. <code>NEXT_VERSION</code>).</p>
</li>
<li>
<p>A GitHub account (i.e. <code>GH_USER</code>) and a token (i.e. <code>GH_TOKEN</code>) with the permission to create and update a release on the <strong>BDeploy</strong> GitHub repository.</p>
</li>
<li>
<p>A SonaType account (i.e. <code>SONATYPE_USER</code>) and a token (i.e. <code>SONATYPE_TOKEN</code>) with the permission to upload and release artifacts to <code>oss.sonatype.org</code> targeting maven central.</p>
</li>
<li>
<p>A GPG Key which is registered with sonatype which can be used to sign the application JAR files for upload to maven. You need the key file (i.e. <code>GPG_FILE</code>), the ID of the key (i.e. <code>GPG_ID</code>) and the password to the key file (i.e. <code>GPG_PASS</code>).</p>
</li>
<li>
<p>A clone of the repository - since right now a internal repository is used as well as the GitHub repository, you need a clone of the internal repository</p>
</li>
<li>
<p>An empty directory where JDKs can be downloaded to. Set the path in the environment variable <code>JDK_DL_ROOT</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the environment variable with the according data prepared in the prerequisites: <code>GH_USER</code>, <code>GH_TOKEN</code>, <code>SONATYPE_USER</code>, <code>SONATYPE_TOKEN</code>, <code>GPG_FILE</code>, <code>GPG_ID</code> and <code>GPG_PASS</code>. Also set <code>RELEASE_VERSION</code> and <code>NEXT_VERSION</code>, or pass the values directly to the command.</p>
</li>
<li>
<p>Execute <code>./release.sh ${RELEASE_VERSION} ${NEXT_VERSION}</code> in the repository. Make sure that the repository has the current master branch checked out and that it is ready to be released.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Download the most current version of the JDK to be used.</p>
</li>
<li>
<p>Set the release version in the source repository.</p>
</li>
<li>
<p>Run the build with all tests but not the binary release tests.</p>
</li>
<li>
<p>Updates documentation screenshots from the UI tests.</p>
</li>
<li>
<p>Publish artifacts to the <code>oss.sonatyp.org</code> server.</p>
</li>
<li>
<p>Note: A separate release step has to be performed manually later, see below.</p>
</li>
<li>
<p>Commit changed files (version, screenshots, test-data) locally (i.e. 'Release ${RELEASE_VERSION}').</p>
</li>
<li>
<p>Push the commit to the GitHub repositories master branch.</p>
</li>
<li>
<p>Publish the built artifacts to a newly created GitHub release.</p>
</li>
<li>
<p>Set the next version in the source repository.</p>
</li>
<li>
<p>Add the just-published version to the versions to be tested in binary release tests.</p>
</li>
<li>
<p>Run the build using the new version without any tests but the binary release test - which will now verify that updating to the "next" version is possible from the just-released release.</p>
</li>
<li>
<p>Commit changed file (version, test-data) locally (i.e. 'Update to ${NEXT_VERSION}').</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<code>release.sh</code> will push the release commit to GitHub, but will <strong>not</strong> push any commit to the origin of the repository. If the internal repository is used, you need to push there manually. Also the update to <code>NEXT_VERSION</code> is not pushed at all, and needs to be pushed separately.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Before pushing to the internal repository, make sure to execute a <code>git fetch --all --tags</code>, since GitHub will create the release tag for us in the GitHub repository automatically.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_release_notes">Release notes</h3>
<div class="paragraph">
<p>While <code>release.sh</code> is running, you can gather release notes by looking at the individual commits that happened since the last release. This is most easily done by looking at the output of:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">git log --no-merges v3.5.0..</pre>
</div>
</div>
<div class="paragraph">
<p>assuming that <code>3.5.0</code> was the last release. Scroll to the bottom of the output and work your way upwards commit after commit. Not <strong>every</strong> commit needs mentioning in the release notes, but quite often nearly every commit ends up in some or another way in the release notes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mavencentral_release">MavenCentral release</h3>
<div class="paragraph">
<p>After running <code>release.sh</code> and pushing all the commits to their respective targets, <code>oss.sonatype.org</code> will contain a new staging repositories for the maven artifacts published by the build.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/staging-repo.png"><img src="images/staging-repo.png" alt="Staging Repository" width="480"></a>
</div>
</div>
<div class="paragraph">
<p>You need to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Log in to see anything useful.</p>
</li>
<li>
<p>Navigate to <strong>Staging Repositories</strong>.</p>
</li>
<li>
<p>Select the <code>iobdeploy-XXXX</code> repository where XXXX is any number.</p>
</li>
<li>
<p>In the lower part of the screen, go to <strong>Content</strong> and check whether the content of the repository looks complete and OK.</p>
</li>
<li>
<p>Select the repository in the upper part of the screen and click <strong>Close</strong>.</p>
</li>
<li>
<p>Wait a few minutes and refresh the view using the <strong>Refresh</strong> button.</p>
</li>
<li>
<p>Once enabled, click the <strong>Release</strong> button which having the repository selected. You can leave the "Drop automatically" checked, this way nothing has to be done after clicking OK anymore.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This will release the new version to maven central. This can take a few minutes, up to half an hour. Also the maven central index can take up to 24 hours to refresh - this is what is used to display data on the maven central homepage. Thus it may be that you cannot find the new version on the homepage, but can already download it using Maven/Gradle.</p>
</div>
</div>
<div class="sect2">
<h3 id="_documentation_update">Documentation Update</h3>
<div class="paragraph">
<p>After the release has been made, we need to update the documentation on the official homepage.</p>
</div>
<div class="paragraph">
<p>Prerequisites:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>BDeploy</strong> main repository, having the <code>Release X.X.X</code> release commit/tag checked out (!).</p>
</li>
<li>
<p>A clone of the official <strong>BDeploy</strong> homepage repository.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the <strong>BDeploy</strong> source repository, change into the <code>doc</code> directory and run</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">../gradlew build</pre>
</div>
</div>
<div class="paragraph">
<p>This will create the documentation artifacts in the <code>build/docs/</code> subdirectory, <code>dev</code> and <code>user</code> for the developer and user documentation respectively.</p>
</div>
<div class="paragraph">
<p>Change in each directory, open <code>index.html</code> and verify that the correct release version number can be seen on the documentation index.</p>
</div>
<div class="paragraph">
<p>Change to the <strong>BDeploy</strong> homepage repository and delete the <code>dev</code> and <code>user</code> directories completely.</p>
</div>
<div class="paragraph">
<p>Copy the <code>dev</code> and <code>user</code> directories from the <strong>BDeploy</strong> source repositories <code>doc/build/docs/</code> directory to the homepage repository. Commit the change and push it to the origin repository. The rest is done automatically by GitHub.</p>
</div>
</div>
<div class="sect2">
<h3 id="_build_tool_integration_plugin_update">Build Tool Integration Plugin Update</h3>
<div class="paragraph">
<p>The <strong>BDeploy</strong> source repository also hosts various build tool integrations as well as test projects for some features (plugins, build tools). After the release they need to be updated as well.</p>
</div>
<div class="paragraph">
<p>Since they need to maven artifacts published earlier, you need to make sure that those are already available from maven central.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>plugins/build-tool-gradle</code> - the Gradle integration.</p>
</li>
<li>
<p><code>plugins/gradle-plugin-test-project</code> - a test project for the Gradle integration.</p>
</li>
<li>
<p><code>plugins/bdeploy-demo-plugin</code> a simple demo <strong>BDeploy</strong> plugin using the public API.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Last but not least, there is also <code>plugins/build-tool-tea</code> - the Eclipse TEA integration. This needs to be updated separately in an Eclipse TEA enabled workspace.</p>
</div>
<div class="paragraph">
<p>For all the others, updating is done using <code>gradle-upgrade-interactive</code>. You need to have that installed globally using npm:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">npm install -g gradle-upgrade-interactive</pre>
</div>
</div>
<div class="paragraph">
<p>Once this is available, <code>cd</code> into each of the directories and run <code>gradle-upgrade-interactive</code>. You will be presented a list of things to update in the given plugin. Select all of them and confirm.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In <code>gradle-plugin-test-project</code> you will not see a <strong>BDeploy</strong> API jar update, as this project uses <strong>BDeploy</strong> only indirectly through the <code>build-tool-gradle</code> project - this is OK.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now build each of the projects, and confirm that everything is OK with the new <strong>BDeploy</strong> release. Finally commit the changes, and you&#8217;re done.</p>
</div>
<div class="sect3">
<h4 id="_publish_gradle_plugin">Publish Gradle Plugin</h4>
<div class="paragraph">
<p>You will need to have a gradle account and the permission to publish in the <code>io.bdeploy</code> namespace.</p>
</div>
<div class="paragraph">
<p>Make sure to setup gradle.properties in your home directory according to the instructions on the gradle manuals (i.e. set the <code>gradle.publish.key</code> and <code>gradle.publish.secret</code> properties).</p>
</div>
<div class="paragraph">
<p>Execute <code>./gradlew publishPlugins</code> in the <code>plugins/build-tool-gradle</code> folder.</p>
</div>
<div class="paragraph">
<p>Make sure to check on the plugin portal if the new version was published.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 4.2.2<br>
Last updated 2021-02-05 10:27:46 +0100
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js"></script>
</body>
</html>